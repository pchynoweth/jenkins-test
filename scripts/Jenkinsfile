pipeline {
    agent any

    environment { 
        GITHUB_SECRET = credentials('github-token') 
    }
    stages {
        stage('Build') {
            steps {
                echo 'Building..'
            }
        }
        stage('Test') {
            steps {
                echo 'parallel'
            }
        }
        stage('Test2') {
            steps {
                echo 'parallel'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
    post {
        success {
            echo 'success'
            sh 'env'
            sh 'curl -X POST  -H "Accept: application/vnd.github.v3+json" https://$GITHUB_SECRET:x-oauth-basic@api.github.com/repos/pchynoweth/jenkins-test/statuses/$GIT_COMMIT -d \'{"state":"success", "context":"test1"}\''
        }
        failure {
            echo 'failure'
            sh 'curl -X POST  -H "Accept: application/vnd.github.v3+json" https://$GITHUB_SECRET:x-oauth-basic@api.github.com/repos/pchynoweth/jenkins-test/statuses/$GIT_COMMIT -d \'{"state":"failure", "context":"test1"}\''
        }
    }
}
